<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å®Œæ•´ç³»çµ±æ¶æ§‹ï¼ˆé¡ä¼¼ RAG æ¶æ§‹åœ–é¢¨æ ¼ï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>å®Œæ•´ç³»çµ±æ¶æ§‹ï¼ˆé¡ä¼¼ RAG æ¶æ§‹åœ–é¢¨æ ¼ï¼‰</h1>
    <div class="mermaid">
flowchart TB
    subgraph DataLayer["ğŸ“Š è³‡æ–™ç²å–å±¤ (Data Acquisition Layer)"]
        direction TB
        Yahoo["Yahoo Finance API<br/>(å¤–éƒ¨è³‡æ–™ä¾†æº)"]
        Loader["MarketDataLoader<br/>(data_loader.py)<br/>â€¢ æ”¯æ´ TW/US/CRYPTO<br/>â€¢ è‡ªå‹•æ ¼å¼åŒ– ticker<br/>â€¢ ä¸‹è¼‰ OHLCV è³‡æ–™"]
        Config["Settings & HEXAGRAM_MAP<br/>(config.py)<br/>â€¢ å…¨åŸŸè¨­å®š<br/>â€¢ 64å¦å°ç…§è¡¨"]
        
        Yahoo --> Loader
        Config --> Loader
    end

    subgraph EncodingLayer["ğŸ”¢ å¦è±¡ç·¨ç¢¼å±¤ (Hexagram Encoding Layer)"]
        direction TB
        Encoder["MarketEncoder<br/>(market_encoder.py)<br/>â€¢ è¨ˆç®—æŠ€è¡“æŒ‡æ¨™<br/>â€¢ RVOL ç™¾åˆ†ä½æ•¸<br/>â€¢ å¤§è¡ä¹‹æ•¸æ˜ å°„<br/>â€¢ å››è±¡(6/7/8/9) â†’ å…­çˆ»"]
        Core["IChingCore<br/>(iching_core.py)<br/>â€¢ æœ¬å¦è§£ç¢¼<br/>â€¢ ä¹‹å¦è¨ˆç®—<br/>â€¢ å‹•çˆ»è­˜åˆ¥"]
        HexMap["HEXAGRAM_MAP<br/>(64å¦å°ç…§è¡¨)"]
        
        Encoder --> Core
        Core --> HexMap
    end

    subgraph KnowledgeLayer["ğŸ“š çŸ¥è­˜æª¢ç´¢å±¤ (Knowledge Retrieval Layer)"]
        direction TB
        Setup["setup_iching_db.py<br/>â€¢ ä¸‹è¼‰æ˜“ç¶“è³‡æ–™<br/>â€¢ è½‰æ›çµ±ä¸€æ ¼å¼"]
        Convert["convert_iching_s2t.py<br/>â€¢ ç°¡é«”è½‰ç¹é«”"]
        JSON["iching_complete.json<br/>(64å¦å®Œæ•´è³‡æ–™)"]
        KLoader["IChingKnowledgeLoader<br/>(knowledge_loader.py)<br/>â€¢ JSON â†’ æ–‡ä»¶ç‰©ä»¶<br/>â€¢ ä¸»å¦ + å…­çˆ»<br/>â€¢ ç´„450ä»½æ–‡ä»¶"]
        VectorDB["IChingVectorStore<br/>(vector_store.py)<br/>â€¢ ChromaDB<br/>â€¢ SentenceTransformers<br/>â€¢ èªç¾©æœå°‹ + åš´æ ¼éæ¿¾"]
        
        Setup --> JSON
        Convert --> JSON
        JSON --> KLoader
        KLoader --> VectorDB
        Convert --> VectorDB
    end

    subgraph AppLayer["ğŸ“± æ‡‰ç”¨å±¤ (Application Layer)"]
        direction TB
        Dashboard["Streamlit Dashboard<br/>(dashboard.py)<br/>â€¢ Kç·šåœ–è¦–è¦ºåŒ–<br/>â€¢ å¦è±¡å¡ç‰‡<br/>â€¢ é‡åŒ–æ©‹æ¥æŒ‡æ¨™<br/>â€¢ Oracle è§£è®€é¡¯ç¤º"]
        Oracle["Oracle é¡åˆ¥<br/>(oracle_chat.py)<br/>â€¢ ä¹‹å¦ç­–ç•¥è§£æ<br/>â€¢ è²/æ‚”æ¶æ§‹<br/>â€¢ æ˜“ç¶“æ–‡æœ¬æª¢ç´¢<br/>â€¢ Gemini API æ•´åˆ"]
        CLI["CLI å·¥å…·<br/>(main.py)<br/>â€¢ å‘½ä»¤åˆ—ä»‹é¢<br/>â€¢ ASCII è—è¡“å¦è±¡"]
        Gemini["Google Gemini API<br/>(å¤–éƒ¨ LLM)<br/>â€¢ gemini-2.5-flash<br/>â€¢ çµæ§‹åŒ–è¼¸å‡º"]
        
        Dashboard --> Oracle
        CLI --> Encoder
        Oracle --> Gemini
    end

    subgraph MLLayer["ğŸ¤– æ©Ÿå™¨å­¸ç¿’å±¤ (ML Layer) - å¯é¸"]
        direction TB
        Processor["DataProcessor<br/>(data_processor.py)<br/>â€¢ æº–å‚™ LSTM è³‡æ–™<br/>â€¢ é›™æµ Embedding<br/>â€¢ æ•¸å€¼ç‰¹å¾µæ¨™æº–åŒ–"]
        LSTM["QuantumLSTM<br/>(model_lstm.py)<br/>â€¢ é›™æµ Embedding<br/>â€¢ 2å±¤ LSTM<br/>â€¢ äºŒåˆ†é¡è¼¸å‡º"]
        Backtest["QuantumBacktester<br/>(backtester.py)<br/>â€¢ ç­–ç•¥å›æ¸¬<br/>â€¢ ç¸¾æ•ˆè©•ä¼°"]
        
        Processor --> LSTM
        LSTM --> Backtest
    end

    %% è³‡æ–™æµç¨‹
    Loader --> Encoder
    Encoder --> Core
    Core --> Dashboard
    Core --> Oracle
    Core --> Processor
    
    Oracle --> VectorDB
    VectorDB --> JSON
    
    Processor --> LSTM

    %% æ¨£å¼
    classDef dataLayer fill:#e8f5e9,stroke:#2e7d32,stroke-width:3px,color:#000
    classDef encodingLayer fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#000
    classDef knowledgeLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
    classDef appLayer fill:#e1f5fe,stroke:#0277bd,stroke-width:3px,color:#000
    classDef mlLayer fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000
    classDef external fill:#fff9c4,stroke:#f9a825,stroke-width:3px,color:#000

    class Yahoo,Loader,Config dataLayer
    class Encoder,Core,HexMap encodingLayer
    class Setup,Convert,JSON,KLoader,VectorDB knowledgeLayer
    class Dashboard,Oracle,CLI appLayer
    class Processor,LSTM,Backtest mlLayer
    class Gemini external

    </div>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>