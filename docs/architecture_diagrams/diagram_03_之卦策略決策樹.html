<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>之卦策略決策樹</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>之卦策略決策樹</h1>
    <div class="mermaid">
flowchart TD
    Start([開始: 獲取 ritual_sequence]) --> Count{"計算動爻數量<br/>(6 和 9 的數量)"}
    
    Count -->|0 動爻| Strategy0["Total Acceptance<br/>查本卦卦辭/象辭"]
    Count -->|1 動爻| Strategy1["Specific Focus<br/>查該動爻文本"]
    Count -->|2 動爻| Strategy2["Primary vs Secondary<br/>下爻貞/上爻悔"]
    Count -->|3 動爻| Strategy3["Hedging Moment<br/>本卦貞/之卦悔"]
    Count -->|4-5 動爻| Strategy45["Trend Reversal<br/>之卦貞/本卦悔"]
    Count -->|6 動爻| Check6{"是否為乾/坤卦?"}
    
    Check6 -->|乾卦| Strategy6Qian["Extreme Reversal<br/>用「用九」"]
    Check6 -->|坤卦| Strategy6Kun["Extreme Reversal<br/>用「用六」"]
    Check6 -->|其他| Strategy6Other["Extreme Reversal<br/>用之卦卦辭"]
    
    Strategy0 --> Query["從 iching_complete.json<br/>抽取對應經文"]
    Strategy1 --> Query
    Strategy2 --> Query
    Strategy3 --> Query
    Strategy45 --> Query
    Strategy6Qian --> Query
    Strategy6Kun --> Query
    Strategy6Other --> Query
    
    Query --> Prompt["構造系統提示<br/>含貞/悔框架"]
    Prompt --> Gemini["Gemini API 生成回答"]
    Gemini --> Output["返回結構化解讀"]
    
    style Strategy0 fill:#e8f5e9
    style Strategy1 fill:#fff3e0
    style Strategy2 fill:#e1f5fe
    style Strategy3 fill:#f3e5f5
    style Strategy45 fill:#fce4ec
    style Strategy6Qian fill:#ffebee
    style Strategy6Kun fill:#ffebee
    style Strategy6Other fill:#ffebee

    </div>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>